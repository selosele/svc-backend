<?xml version="1.0" encoding="utf-8" ?>

<SmartSqlMap Scope="EmployeeCompanyRepository" xmlns="http://SmartSql.net/schemas/SmartSqlMap.xsd">
  <ResultMaps>
    <ResultMap Id="EmployeeCompanyResultMap">
      <Result Column="EMPLOYEE_COMPANY_ID" Property="EmployeeCompanyId" />
      <Result Column="COMPANY_ID" Property="CompanyId" />
      <Result Column="CORPORATE_NAME" Property="CorporateName" />
      <Result Column="COMPANY_NAME" Property="CompanyName" />
      <Result Column="RANK_CODE" Property="RankCode" />
      <Result Column="JOB_TITLE_CODE" Property="JobTitleCode" />
      <Result Column="JOIN_YMD" Property="JoinYmd" />
      <Result Column="QUIT_YMD" Property="QuitYmd" />
    </ResultMap>
  </ResultMaps>

  <Statements>

    <!-- 직원 회사 목록을 조회한다. -->
    <Statement Id="ListEmployeeCompany" ResultMap="EmployeeCompanyResultMap">
      /* EmployeeCompanyRepository.ListEmployeeCompany */

      SELECT
        EC.EMPLOYEE_COMPANY_ID,
        C.COMPANY_ID,
        C.CORPORATE_NAME,
        C.COMPANY_NAME,
        EC.JOIN_YMD,
        EC.QUIT_YMD
      FROM HM_EMPLOYEE_COMPANY EC
      INNER JOIN HM_COMPANY C ON C.COMPANY_ID = EC.COMPANY_ID
      WHERE EC.EMPLOYEE_ID = @EmployeeId
        AND EC.DELETE_YN = 'N'
      ORDER BY EC.JOIN_YMD DESC
    </Statement>

    <!-- 직원 회사를 조회한다. -->
    <Statement Id="GetEmployeeCompany" ResultMap="EmployeeCompanyResultMap">
      /* EmployeeCompanyRepository.GetEmployeeCompany */

      SELECT
        EC.EMPLOYEE_COMPANY_ID,
        C.COMPANY_ID,
        C.CORPORATE_NAME,
        C.COMPANY_NAME,
        EC.RANK_CODE,
        EC.JOB_TITLE_CODE,
        EC.JOIN_YMD,
        EC.QUIT_YMD
      FROM HM_EMPLOYEE_COMPANY EC
      INNER JOIN HM_COMPANY C ON C.COMPANY_ID = EC.COMPANY_ID
      WHERE 1=1
        <IsNotEmpty Property="EmployeeCompanyId">
        AND EC.EMPLOYEE_COMPANY_ID = @EmployeeCompanyId
        </IsNotEmpty>
        <IsNotEmpty Property="EmployeeId">
        AND EC.EMPLOYEE_ID = @EmployeeId
        </IsNotEmpty>
        <IsNotEmpty Property="CompanyId">
        AND C.COMPANY_ID = @CompanyId
        </IsNotEmpty>
    </Statement>

    <!-- 직원 회사를 수정한다. -->
    <Statement Id="UpdateEmployeeCompany">
      /* EmployeeCompanyRepository.UpdateEmployeeCompany */

      UPDATE HM_EMPLOYEE_COMPANY
        SET
          <IsNotEmpty Property="RankCode">
          RANK_CODE = @RankCode,
          </IsNotEmpty>
          <IsNotEmpty Property="JobTitleCode">
          JOB_TITLE_CODE = @JobTitleCode,
          </IsNotEmpty>
          <IsNotEmpty Property="JoinYmd">
          JOIN_YMD = @JoinYmd,
          </IsNotEmpty>
          <IsNotEmpty Property="QuitYmd">
          QUIT_YMD = @QuitYmd,
          </IsNotEmpty>
          UPDATER_ID = @UpdaterId,
          UPDATE_DT = CURRENT_TIMESTAMP()
      WHERE EMPLOYEE_COMPANY_ID = @EmployeeCompanyId
    </Statement>

    <!-- 직원 회사를 삭제한다. -->
    <Statement Id="RemoveEmployeeCompany">
      /* EmployeeCompanyRepository.RemoveEmployeeCompany */

      UPDATE HM_EMPLOYEE_COMPANY
        SET
          DELETE_YN = 'Y',
          UPDATER_ID = @UpdaterId,
          UPDATE_DT = CURRENT_TIMESTAMP()
      WHERE EMPLOYEE_COMPANY_ID = @EmployeeCompanyId
    </Statement>

    <!-- 직원 부서를 수정한다. -->
    <Statement Id="UpdateEmployeeDepartment">
      /* EmployeeCompanyRepository.UpdateEmployeeDepartment */

      UPDATE HM_EMPLOYEE_COMPANY
        SET
          RANK_CODE = @RankCode,
          JOB_TITLE_CODE = @JobTitleCode,
          UPDATER_ID = @UpdaterId,
          UPDATE_DT = CURRENT_TIMESTAMP()
      WHERE EMPLOYEE_COMPANY_ID = @EmployeeCompanyId
    </Statement>
    
  </Statements>
</SmartSqlMap>