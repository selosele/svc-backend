<?xml version="1.0" encoding="utf-8" ?>

<SmartSqlMap Scope="UserCertHistoryRepository" xmlns="http://SmartSql.net/schemas/SmartSqlMap.xsd">
  <ResultMaps>
    <ResultMap Id="UserResultMap">
      <Result Column="USER_ID" Property="UserId" />
      <Result Column="USER_ACCOUNT" Property="UserAccount" />
      <Result Column="EMPLOYEE_NAME" Property="EmployeeName" />
      <Result Column="COMPANY_NAME" Property="CompanyName" />
      <Result Column="RANK_CODE_NAME" Property="RankCodeName" />
      <Result Column="JOB_TITLE_CODE_NAME" Property="JobTitleCodeName" />
      <Result Column="USER_ACTIVE_YN" Property="UserActiveYn" />
      <Result Column="LAST_LOGIN_DT" Property="LastLoginDt" />
      <Result Column="ROLES_STRING" Property="RolesString" />
    </ResultMap>
  </ResultMaps>

  <Statements>

    <!-- 사용자 본인인증 내역을 조회한다. -->
    <Statement Id="GetUserUserCertHistory" ResultMap="UserResultMap">
      /* UserCertHistoryRepository.GetUserUserCertHistory */

      SELECT
        U.USER_ID,
        U.USER_ACCOUNT,
        U.USER_ACTIVE_YN,
        DATE_FORMAT(U.LAST_LOGIN_DT, '%Y-%m-%d %H:%i:%s') AS LAST_LOGIN_DT
      FROM CO_USER U
      WHERE 1=1
        AND U.DELETE_YN = 'N'
        <IsNotEmpty Property="UserId">
        AND U.USER_ID = @UserId
        </IsNotEmpty>
        <IsNotEmpty Property="UserAccount">
        AND U.USER_ACCOUNT = @UserAccount
        </IsNotEmpty>
    </Statement>

    <!-- 사용자 본인인증 내역을 추가한다. -->
    <Statement Id="AddUserCertHistory">
      /* UserCertHistoryRepository.AddUserCertHistory */

      INSERT INTO CO_USER (
        USER_ACCOUNT,
        PHONE_NO,
        EMAIL_ADDR,
        CERT_CODE,
        CERT_METHOD_CODE,
        CERT_TYPE_CODE,
        VALID_TIME,
        CREATER_ID
      )
      VALUES (
        @UserAccount,
        @PhoneNo,
        @EmailAddr,
        @CertCode,
        @CertMethodCode,
        @CertTypeCode,
        @ValidTime,
        @CreaterId
      )
    </Statement>
    
  </Statements>
</SmartSqlMap>