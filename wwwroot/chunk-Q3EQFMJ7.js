import{a as he}from"./chunk-MU3YDR2J.js";import{b as fe}from"./chunk-RKIYAYDT.js";import{F as Ce,f as B,h as re,i as I,l as ne,m as se,n as le,o as m,p as ae,q as ue,u as de,w as me,x as ce,y as pe}from"./chunk-7VAYUDPN.js";import{$a as O,A as h,Da as E,Dc as Z,E as F,Ec as ee,Ja as $,K as o,L as f,La as P,Ob as K,T as x,Uc as te,V as y,Vb as V,X as s,Xb as Y,Zb as z,_b as J,aa as v,ab as Q,ba as R,ca as L,da as j,ea as l,fa as a,fd as ie,ga as d,id as oe,jb as G,ka as w,la as _,ma as c,qa as q,ra as H,sa as M,tc as k,ua as b,v as A,vc as W,wa as T,y as N,z as C,zc as X}from"./chunk-M3GQJLHA.js";import"./chunk-M6OTSRMF.js";import"./chunk-FK6H3RFT.js";import{a as D,b as U,f as g}from"./chunk-USDYGGWM.js";function be(r,u){if(r&1&&(l(0,"p",2),b(1),$(2,"date"),a()),r&2){let n=c();o(),T("\uB9C8\uC9C0\uB9C9 \uB85C\uADF8\uC778 \uC77C\uC2DC: ",P(2,1,n.detailForm.get("lastLoginDt").value,"yyyy\uB144 MM\uC6D4 dd\uC77C hh\uC2DC mm\uBD84 ss\uCD08"),"")}}function De(r,u){if(r&1&&(l(0,"div",4),d(1,"ui-text-field",21),a()),r&2){let n=c();o(),s("control",n.detailForm.get("userId"))("label","\uC0AC\uC6A9\uC790 ID")("readonly",!0)}}function ge(r,u){if(r&1&&(l(0,"div",4),d(1,"ui-text-field",22),a()),r&2){let n=c();o(),s("control",n.detailForm.get("userPassword"))("label","\uC0AC\uC6A9\uC790 \uBE44\uBC00\uBC88\uD638")("placeholder","12\uC790 \uC774\uB0B4")}}function we(r,u){if(r&1){let n=w();l(0,"div",7)(1,"ui-button",23),_("click",function(t){C(n);let e=c();return h(e.updateUserActiveYn(t,(e.detail==null?null:e.detail.userActiveYn)==="Y"?"N":"Y"))}),b(2),a()()}if(r&2){let n=c();o(),s("severity","secondary"),o(),T(" ",(n.detail==null?null:n.detail.userActiveYn)==="Y"?"\uC7A0\uAE08\uC124\uC815":"\uC7A0\uAE08\uD574\uC81C"," ")}}function Ue(r,u){if(r&1&&d(0,"ui-checkbox",10),r&2){let n=u.$implicit,i=c();s("control",i.detailForm.get("roles"))("label",n.roleName)("value",n.roleId)}}function Ae(r,u){if(r&1){let n=w();l(0,"ui-button",24),_("click",function(){C(n);let t=c();return h(t.superLogin())}),b(1,"\uB85C\uADF8\uC778"),a()}}var ye=(()=>{let u=class u extends B{constructor(i,t,e,p,S,ve){super(),this.fb=i,this.route=t,this.roleStore=e,this.messageService=p,this.userService=S,this.codeService=ve,this.detail=null,this.ynCodes=this.codeService.createYnCodeData(),this.defaultUserActiveYn="Y",this.roles=[],this.defaultRoles=[],this.useRemove=!0,this.isUserSelf=!1,this.refresh=new F,this.remove=new F,this.close=new F}get isDetailNotEmpty(){return J(this.detail)}ngOnInit(){this.route.data.subscribe(({code:i})=>{this.genderCodes=i.GENDER_00,this.rankCodes=i.RANK_00,this.jobTitleCodes=i.JOB_TITLE_00}),this.detailForm=this.fb.group({userId:[""],userAccount:["",[m.required,m.minLength(3),m.maxLength(20)]],userPassword:["",[m.required]],userActiveYn:["",[m.required]],lastLoginDt:[""],roles:["",[m.required]],employee:this.fb.group({employeeId:[""],employeeName:["",[m.required,m.maxLength(30)]],genderCode:["",[m.required]],birthYmd:[""],phoneNo:[""],emailAddr:["",[m.email]],workHistory:this.fb.group({workHistoryId:[""],companyId:[""],corporateName:["",[m.required]],companyName:["",[m.required]],joinYmd:["",[m.required]],quitYmd:[""],rankCode:["",[m.required]],jobTitleCode:["",[m.required]]})})})}ngOnChanges(i){if(i.detail&&this.detailForm){if(this.isUserSelf=Number(this.user?.userId)===this.detail.userId,this.useRemove=!this.isUserSelf,this.roles=this.roleStore.select("roleList").value,this.defaultRoles=this.roles.filter(t=>t.roleId===K.EMPLOYEE.id).map(t=>t.roleId),z(i.detail.currentValue)){this.useRemove=!1,this.detailForm.reset({userActiveYn:this.defaultUserActiveYn,roles:this.defaultRoles,employee:{workHistory:{jobTitleCode:"0098"}}}),this.detailForm.get("userPassword").setValidators([m.required,m.maxLength(12)]),this.detailForm.get("userPassword").updateValueAndValidity();return}this.detailForm.get("userPassword").clearValidators(),this.detailForm.get("userPassword").patchValue(null),this.detailForm.get("userPassword").updateValueAndValidity(),this.detailForm.patchValue(U(D({},this.detail),{roles:this.detail?.roles?.map(t=>t.roleId)||this.defaultRoles,employee:U(D({},this.detail?.employee),{workHistory:this.detail?.employee?.workHistoryList[0]})}))}}updateUserActiveYn(i,t){return g(this,null,function*(){(yield this.messageService.confirm1(`\uACC4\uC815\uC744 ${t==="Y"?"\uC7A0\uAE08\uD574\uC81C\uD558\uC2DC\uACA0\uC5B4\uC694?":"\uC7A0\uADF8\uC2DC\uACA0\uC5B4\uC694?"}`))&&this.userService.updateUser$({userId:this.detail?.userId,userActiveYn:t}).subscribe(p=>{this.messageService.toastSuccess("\uC815\uC0C1\uC801\uC73C\uB85C \uCC98\uB9AC\uB418\uC5C8\uC5B4\uC694."),this.detail=p.user,this.detailForm.patchValue(U(D(D({},this.detailForm.value),this.detail),{roles:this.detail?.roles?.map(S=>S.roleId)})),this.refresh.emit()})})}onSubmit(i){return g(this,null,function*(){let t=V(i.userId)?"\uB4F1\uB85D":"\uC218\uC815";(yield this.messageService.confirm1(`\uC0AC\uC6A9\uC790 \uBC0F \uC9C1\uC6D0 \uC815\uBCF4\uB97C ${t}\uD558\uC2DC\uACA0\uC5B4\uC694?`))&&(V(i.userId)?this.userService.addUser$(i).subscribe(p=>{this.messageService.toastSuccess(`\uC815\uC0C1\uC801\uC73C\uB85C ${t}\uB418\uC5C8\uC5B4\uC694.`),this.detailForm.get("userId").patchValue(p.user.userId),this.refresh.emit()}):this.userService.updateUser$(i).subscribe(p=>{this.messageService.toastSuccess(`\uC815\uC0C1\uC801\uC73C\uB85C ${t}\uB418\uC5C8\uC5B4\uC694.`),this.refresh.emit()}))})}onRemove(i){return g(this,null,function*(){(yield this.messageService.confirm2("\uC0AC\uC6A9\uC790\uB97C \uC0AD\uC81C\uD558\uC2DC\uACA0\uC5B4\uC694?<br>\uC774 \uC791\uC5C5\uC740 \uBCF5\uAD6C\uD560 \uC218 \uC5C6\uC5B4\uC694."))&&this.userService.removeUser$(this.detail.userId).subscribe(()=>{this.messageService.toastSuccess("\uC815\uC0C1\uC801\uC73C\uB85C \uC0AD\uC81C\uB418\uC5C8\uC5B4\uC694."),this.remove.emit()})})}superLogin(){return g(this,null,function*(){(yield this.messageService.confirm1(`${this.detail.userAccount}(${this.detail.employee.employeeName}\uB2D8) \uACC4\uC815\uC73C\uB85C \uB85C\uADF8\uC778\uD558\uC2DC\uACA0\uC5B4\uC694?`))&&this.authService.superLogin({userAccount:this.detail.userAccount})})}onClose(){this.close.emit()}};u.\u0275fac=function(t){return new(t||u)(f(te),f(G),f(he),f(oe),f(I),f(fe))},u.\u0275cmp=A({type:u,selectors:[["system-user-detail"]],inputs:{detail:"detail"},outputs:{refresh:"refresh",remove:"remove",close:"close"},standalone:!0,features:[x,N,E],decls:44,vars:53,consts:[[3,"submit","remove","close","form","useRemove"],[3,"text"],[1,"mt-2"],[1,"grid","mt-2","mb-4"],[1,"col"],[3,"control","label","readonly","placeholder"],[3,"control","label","data","readonly"],[1,"col","flex","align-items-end"],[1,"col-12"],[3,"label"],[3,"control","label","value"],[1,"grid","mt-2"],[1,"col-3"],[3,"control","label","placeholder"],[3,"control","label","data"],[1,"col-4"],[3,"control","label","dateFormat","placeholder"],[3,"control","label"],[1,"col-6"],[3,"control"],["button",""],[3,"control","label","readonly"],["type","password",3,"control","label","placeholder"],["button","",3,"click","severity"],["button","",3,"click"]],template:function(t,e){t&1&&(l(0,"ui-split-form",0),_("submit",function(S){return e.onSubmit(S)})("remove",function(S){return e.onRemove(S)})("close",function(){return e.onClose()}),d(1,"ui-content-title",1),y(2,be,3,4,"p",2),l(3,"div",3),y(4,De,2,3,"div",4),l(5,"div",4),d(6,"ui-text-field",5),a(),y(7,ge,2,3,"div",4),l(8,"div",4),d(9,"ui-dropdown",6),a(),y(10,we,3,2,"div",7),l(11,"div",8)(12,"ui-checkbox-group",9)(13,"ui-card")(14,"ui-checkbox-list"),L(15,Ue,1,3,"ui-checkbox",10,R),a()()()()(),d(17,"ui-content-title",1),l(18,"div",11)(19,"div",12),d(20,"ui-text-field",13),a(),l(21,"div",12),d(22,"ui-dropdown",14),a(),l(23,"div",12),d(24,"ui-dropdown",14),a(),l(25,"div",12),d(26,"ui-dropdown",14),a(),l(27,"div",15),d(28,"ui-date-field",16),a(),l(29,"div",15),d(30,"ui-text-field",13),a(),l(31,"div",15),d(32,"ui-text-field",17),a(),l(33,"div",18),d(34,"ui-hidden-field",19)(35,"ui-hidden-field",19)(36,"ui-company-field",17),a(),l(37,"div",18),d(38,"ui-company-field",17),a(),l(39,"div",18),d(40,"ui-date-field",16),a(),l(41,"div",18),d(42,"ui-date-field",16),a()(),y(43,Ae,2,0,"ui-button",20),a()),t&2&&(s("form",e.detailForm)("useRemove",e.useRemove),o(),s("text","\uC0AC\uC6A9\uC790 \uC815\uBCF4"),o(),v(e.isDetailNotEmpty?2:-1),o(2),v(e.isDetailNotEmpty?4:-1),o(2),s("control",e.detailForm.get("userAccount"))("label","\uC0AC\uC6A9\uC790 \uACC4\uC815")("readonly",e.isDetailNotEmpty)("placeholder","20\uC790 \uC774\uB0B4"),o(),v(e.isDetailNotEmpty?-1:7),o(2),s("control",e.detailForm.get("userActiveYn"))("label","\uC0AC\uC6A9\uC790 \uACC4\uC815 \uD65C\uC131\uD654")("data",e.ynCodes)("readonly",e.isDetailNotEmpty),o(),v(e.isDetailNotEmpty&&!e.isUserSelf?10:-1),o(2),s("label","\uC0AC\uC6A9\uC790 \uAD8C\uD55C"),o(3),j(e.roles),o(2),s("text","\uC9C1\uC6D0 \uC815\uBCF4"),o(3),s("control",e.detailForm.get("employee.employeeName"))("label","\uC9C1\uC6D0\uBA85")("placeholder","30\uC790 \uC774\uB0B4"),o(2),s("control",e.detailForm.get("employee.genderCode"))("label","\uC131\uBCC4")("data",e.genderCodes),o(2),s("control",e.detailForm.get("employee.workHistory.rankCode"))("label","\uC9C1\uC704")("data",e.rankCodes),o(2),s("control",e.detailForm.get("employee.workHistory.jobTitleCode"))("label","\uC9C1\uCC45")("data",e.jobTitleCodes),o(2),s("control",e.detailForm.get("employee.birthYmd"))("label","\uC0DD\uB144\uC6D4\uC77C")("dateFormat","yymmdd")("placeholder","YYYYMMDD"),o(2),s("control",e.detailForm.get("employee.phoneNo"))("label","\uD734\uB300\uD3F0\uBC88\uD638")("placeholder","- \uC81C\uC678"),o(2),s("control",e.detailForm.get("employee.emailAddr"))("label","\uC774\uBA54\uC77C\uC8FC\uC18C"),o(2),s("control",e.detailForm.get("employee.workHistory.workHistoryId")),o(),s("control",e.detailForm.get("employee.workHistory.companyId")),o(),s("control",e.detailForm.get("employee.workHistory.corporateName"))("label","\uD68C\uC0AC(\uBC95\uC778)\uBA85"),o(2),s("control",e.detailForm.get("employee.workHistory.companyName"))("label","\uD68C\uC0AC\uBA85"),o(2),s("control",e.detailForm.get("employee.workHistory.joinYmd"))("label","\uC785\uC0AC\uC77C\uC790")("dateFormat","yymmdd")("placeholder","YYYYMMDD"),o(2),s("control",e.detailForm.get("employee.workHistory.quitYmd"))("label","\uD1F4\uC0AC\uC77C\uC790")("dateFormat","yymmdd")("placeholder","YYYYMMDD"),o(),v(e.isDetailNotEmpty&&!e.isUserSelf?43:-1))},dependencies:[Q,O,ae,ne,me,pe,ce,le,se,de,k,ue,X,W]});let r=u;return r})();var Fe=["splitter"];function xe(r,u){r&1&&d(0,"ui-skeleton")(1,"ui-skeleton")(2,"ui-skeleton")}function Ee(r,u){if(r&1){let n=w();l(0,"ui-splitter",null,0)(2,"ui-table",2,1),_("refresh",function(){C(n);let t=c();return h(t.onRefresh())})("rowSelect",function(t){C(n);let e=c();return h(e.onRowSelect(t))})("unRowSelect",function(t){C(n);let e=c();return h(e.onRowUnselect(t))}),l(4,"ui-button",3),_("click",function(){C(n);let t=c();return h(t.addUser())}),a()(),l(5,"div",4)(6,"system-user-detail",5),_("refresh",function(){C(n);let t=c();return h(t.listUser())})("remove",function(){C(n);let t=c();return h(t.onRemove())})("close",function(){C(n);let t=c();return h(t.onClose())}),a()()()}if(r&2){let n=c();o(2),s("useAdd",!1)("useRemove",!1)("cols",n.cols)("data",n.userList)("dataKey","userId")("selection",n.selection),o(2),s("size","small")("icon","pi-plus")("label","\uC0AC\uC6A9\uC790 \uB4F1\uB85D")("outlined",!0),o(2),s("detail",n.detail)}}var Ze=(()=>{let u=class u extends B{constructor(i,t){super(),this.userStore=i,this.userService=t,this.detail=null,this.cols=[{field:"userAccount",header:"\uC0AC\uC6A9\uC790 \uACC4\uC815"},{field:"employeeName",header:"\uC9C1\uC6D0\uBA85"},{field:"companyName",header:"\uD68C\uC0AC\uBA85"},{header:"\uC9C1\uC704/\uC9C1\uCC45",valueGetter:e=>e.jobTitleCode==="ETC"?e.rankCodeName:Y(e.rankCodeName)&&Y(e.jobTitleCodeName)?"":`${e.rankCodeName}/${e.jobTitleCodeName}`},{field:"userActiveYn",header:"\uC0AC\uC6A9\uC790 \uD65C\uC131\uD654 \uC5EC\uBD80"},{field:"rolesString",header:"\uAD8C\uD55C"}]}get userList(){return this.userStore.select("userList").value}get userListDataLoad(){return this.userStore.select("userListDataLoad").value}ngOnInit(){!this.userListDataLoad&&this.user&&this.listUser()}listUser(){this.userService.listUser()}addUser(){this.detail={},this.splitter.show()}onRowSelect(i){this.userService.getUser$(i.data.userId).subscribe(t=>{this.detail=t.user,this.splitter.show()})}onRowUnselect(i){this.detail={},this.splitter.hide()}onRefresh(){this.listUser()}onRemove(){this.splitter.hide(),this.listUser()}onClose(){this.splitter.hide()}};u.\u0275fac=function(t){return new(t||u)(f(re),f(I))},u.\u0275cmp=A({type:u,selectors:[["view-system-user"]],viewQuery:function(t,e){if(t&1&&q(Fe,5),t&2){let p;H(p=M())&&(e.splitter=p.first)}},standalone:!0,features:[x,E],decls:8,vars:1,consts:[["splitter",""],["table",""],["first","",3,"refresh","rowSelect","unRowSelect","useAdd","useRemove","cols","data","dataKey","selection"],["buttons","",3,"click","size","icon","label","outlined"],["second",""],[3,"refresh","remove","close","detail"]],template:function(t,e){t&1&&(l(0,"layout-page-description")(1,"ul")(2,"li"),b(3,"\uC0AC\uC6A9\uC790\uB97C \uC870\uD68C/\uC785\uB825\uD560 \uC218 \uC788\uC5B4\uC694."),a(),l(4,"li"),b(5,"\uC0AC\uC6A9\uC790\uC5D0\uAC8C \uAD8C\uD55C\uC744 \uBD80\uC5EC/\uD68C\uC218\uD560 \uC218 \uC788\uC5B4\uC694."),a()()(),y(6,xe,3,0)(7,Ee,7,11,"ui-splitter")),t&2&&(o(6),v(e.userListDataLoad?7:6))},dependencies:[k,Z,ie,ee,Ce,ye]});let r=u;return r})();export{Ze as SystemUserComponent};
