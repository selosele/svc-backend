import{a as x}from"./chunk-USDYGGWM.js";var a=function(l){return l[l.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",l[l.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",l[l.CLASS_TO_CLASS=2]="CLASS_TO_CLASS",l}(a||{});var C=class{constructor(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}addTypeMetadata(t){this._typeMetadatas.has(t.target)||this._typeMetadatas.set(t.target,new Map),this._typeMetadatas.get(t.target).set(t.propertyName,t)}addTransformMetadata(t){this._transformMetadatas.has(t.target)||this._transformMetadatas.set(t.target,new Map),this._transformMetadatas.get(t.target).has(t.propertyName)||this._transformMetadatas.get(t.target).set(t.propertyName,[]),this._transformMetadatas.get(t.target).get(t.propertyName).push(t)}addExposeMetadata(t){this._exposeMetadatas.has(t.target)||this._exposeMetadatas.set(t.target,new Map),this._exposeMetadatas.get(t.target).set(t.propertyName,t)}addExcludeMetadata(t){this._excludeMetadatas.has(t.target)||this._excludeMetadatas.set(t.target,new Map),this._excludeMetadatas.get(t.target).set(t.propertyName,t)}findTransformMetadatas(t,e,n){return this.findMetadatas(this._transformMetadatas,t,e).filter(f=>!f.options||f.options.toClassOnly===!0&&f.options.toPlainOnly===!0?!0:f.options.toClassOnly===!0?n===a.CLASS_TO_CLASS||n===a.PLAIN_TO_CLASS:f.options.toPlainOnly===!0?n===a.CLASS_TO_PLAIN:!0)}findExcludeMetadata(t,e){return this.findMetadata(this._excludeMetadatas,t,e)}findExposeMetadata(t,e){return this.findMetadata(this._exposeMetadatas,t,e)}findExposeMetadataByCustomName(t,e){return this.getExposedMetadatas(t).find(n=>n.options&&n.options.name===e)}findTypeMetadata(t,e){return this.findMetadata(this._typeMetadatas,t,e)}getStrategy(t){let e=this._excludeMetadatas.get(t),n=e&&e.get(void 0),f=this._exposeMetadatas.get(t),o=f&&f.get(void 0);return n&&o||!n&&!o?"none":n?"excludeAll":"exposeAll"}getExposedMetadatas(t){return this.getMetadata(this._exposeMetadatas,t)}getExcludedMetadatas(t){return this.getMetadata(this._excludeMetadatas,t)}getExposedProperties(t,e){return this.getExposedMetadatas(t).filter(n=>!n.options||n.options.toClassOnly===!0&&n.options.toPlainOnly===!0?!0:n.options.toClassOnly===!0?e===a.CLASS_TO_CLASS||e===a.PLAIN_TO_CLASS:n.options.toPlainOnly===!0?e===a.CLASS_TO_PLAIN:!0).map(n=>n.propertyName)}getExcludedProperties(t,e){return this.getExcludedMetadatas(t).filter(n=>!n.options||n.options.toClassOnly===!0&&n.options.toPlainOnly===!0?!0:n.options.toClassOnly===!0?e===a.CLASS_TO_CLASS||e===a.PLAIN_TO_CLASS:n.options.toPlainOnly===!0?e===a.CLASS_TO_PLAIN:!0).map(n=>n.propertyName)}clear(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()}getMetadata(t,e){let n=t.get(e),f;n&&(f=Array.from(n.values()).filter(c=>c.propertyName!==void 0));let o=[];for(let c of this.getAncestors(e)){let s=t.get(c);if(s){let r=Array.from(s.values()).filter(p=>p.propertyName!==void 0);o.push(...r)}}return o.concat(f||[])}findMetadata(t,e,n){let f=t.get(e);if(f){let o=f.get(n);if(o)return o}for(let o of this.getAncestors(e)){let c=t.get(o);if(c){let s=c.get(n);if(s)return s}}}findMetadatas(t,e,n){let f=t.get(e),o;f&&(o=f.get(n));let c=[];for(let s of this.getAncestors(e)){let r=t.get(s);r&&r.has(n)&&c.push(...r.get(n))}return c.slice().reverse().concat((o||[]).slice().reverse())}getAncestors(t){if(!t)return[];if(!this._ancestorsMap.has(t)){let e=[];for(let n=Object.getPrototypeOf(t.prototype.constructor);typeof n.prototype<"u";n=Object.getPrototypeOf(n.prototype.constructor))e.push(n);this._ancestorsMap.set(t,e)}return this._ancestorsMap.get(t)}};var m=new C;function I(){if(typeof globalThis<"u")return globalThis;if(typeof global<"u")return global;if(typeof window<"u")return window;if(typeof self<"u")return self}function w(l){return l!==null&&typeof l=="object"&&typeof l.then=="function"}function F(l){let t=new l;return!(t instanceof Set)&&!("push"in t)?[]:t}var A=class{constructor(t,e){this.transformationType=t,this.options=e,this.recursionStack=new Set}transform(t,e,n,f,o,c=0){if(Array.isArray(e)||e instanceof Set){let s=f&&this.transformationType===a.PLAIN_TO_CLASS?F(f):[];return e.forEach((r,p)=>{let _=t?t[p]:void 0;if(!this.options.enableCircularCheck||!this.isCircular(r)){let h;if(typeof n!="function"&&n&&n.options&&n.options.discriminator&&n.options.discriminator.property&&n.options.discriminator.subTypes){if(this.transformationType===a.PLAIN_TO_CLASS){h=n.options.discriminator.subTypes.find(T=>T.name===r[n.options.discriminator.property]);let d={newObject:s,object:r,property:void 0},S=n.typeFunction(d);h===void 0?h=S:h=h.value,n.options.keepDiscriminatorProperty||delete r[n.options.discriminator.property]}this.transformationType===a.CLASS_TO_CLASS&&(h=r.constructor),this.transformationType===a.CLASS_TO_PLAIN&&(r[n.options.discriminator.property]=n.options.discriminator.subTypes.find(d=>d.value===r.constructor).name)}else h=n;let y=this.transform(_,r,h,void 0,r instanceof Map,c+1);s instanceof Set?s.add(y):s.push(y)}else this.transformationType===a.CLASS_TO_CLASS&&(s instanceof Set?s.add(r):s.push(r))}),s}else{if(n===String&&!o)return e==null?e:String(e);if(n===Number&&!o)return e==null?e:Number(e);if(n===Boolean&&!o)return e==null?e:!!e;if((n===Date||e instanceof Date)&&!o)return e instanceof Date?new Date(e.valueOf()):e==null?e:new Date(e);if(I().Buffer&&(n===Buffer||e instanceof Buffer)&&!o)return e==null?e:Buffer.from(e);if(w(e)&&!o)return new Promise((s,r)=>{e.then(p=>s(this.transform(void 0,p,n,void 0,void 0,c+1)),r)});if(!o&&e!==null&&typeof e=="object"&&typeof e.then=="function")return e;if(typeof e=="object"&&e!==null){!n&&e.constructor!==Object&&(!Array.isArray(e)&&e.constructor===Array||(n=e.constructor)),!n&&t&&(n=t.constructor),this.options.enableCircularCheck&&this.recursionStack.add(e);let s=this.getKeys(n,e,o),r=t||{};!t&&(this.transformationType===a.PLAIN_TO_CLASS||this.transformationType===a.CLASS_TO_CLASS)&&(o?r=new Map:n?r=new n:r={});for(let p of s){if(p==="__proto__"||p==="constructor")continue;let _=p,h=p,y=p;if(!this.options.ignoreDecorators&&n){if(this.transformationType===a.PLAIN_TO_CLASS){let i=m.findExposeMetadataByCustomName(n,p);i&&(y=i.propertyName,h=i.propertyName)}else if(this.transformationType===a.CLASS_TO_PLAIN||this.transformationType===a.CLASS_TO_CLASS){let i=m.findExposeMetadata(n,p);i&&i.options&&i.options.name&&(h=i.options.name)}}let d;this.transformationType===a.PLAIN_TO_CLASS?d=e[_]:e instanceof Map?d=e.get(_):e[_]instanceof Function?d=e[_]():d=e[_];let S,T=d instanceof Map;if(n&&o)S=n;else if(n){let i=m.findTypeMetadata(n,y);if(i){let u={newObject:r,object:e,property:y},N=i.typeFunction?i.typeFunction(u):i.reflectedType;i.options&&i.options.discriminator&&i.options.discriminator.property&&i.options.discriminator.subTypes?e[_]instanceof Array?S=i:(this.transformationType===a.PLAIN_TO_CLASS&&(S=i.options.discriminator.subTypes.find(O=>{if(d&&d instanceof Object&&i.options.discriminator.property in d)return O.name===d[i.options.discriminator.property]}),S===void 0?S=N:S=S.value,i.options.keepDiscriminatorProperty||d&&d instanceof Object&&i.options.discriminator.property in d&&delete d[i.options.discriminator.property]),this.transformationType===a.CLASS_TO_CLASS&&(S=d.constructor),this.transformationType===a.CLASS_TO_PLAIN&&d&&(d[i.options.discriminator.property]=i.options.discriminator.subTypes.find(O=>O.value===d.constructor).name)):S=N,T=T||i.reflectedType===Map}else if(this.options.targetMaps)this.options.targetMaps.filter(u=>u.target===n&&!!u.properties[y]).forEach(u=>S=u.properties[y]);else if(this.options.enableImplicitConversion&&this.transformationType===a.PLAIN_TO_CLASS){let u=Reflect.getMetadata("design:type",n.prototype,y);u&&(S=u)}}let P=Array.isArray(e[_])?this.getReflectedType(n,y):void 0,g=t?t[_]:void 0;if(r.constructor.prototype){let i=Object.getOwnPropertyDescriptor(r.constructor.prototype,h);if((this.transformationType===a.PLAIN_TO_CLASS||this.transformationType===a.CLASS_TO_CLASS)&&(i&&!i.set||r[h]instanceof Function))continue}if(!this.options.enableCircularCheck||!this.isCircular(d)){let i=this.transformationType===a.PLAIN_TO_CLASS?h:p,u;this.transformationType===a.CLASS_TO_PLAIN?(u=e[i],u=this.applyCustomTransformations(u,n,i,e,this.transformationType),u=e[i]===u?d:u,u=this.transform(g,u,S,P,T,c+1)):d===void 0&&this.options.exposeDefaultValues?u=r[h]:(u=this.transform(g,d,S,P,T,c+1),u=this.applyCustomTransformations(u,n,i,e,this.transformationType)),(u!==void 0||this.options.exposeUnsetFields)&&(r instanceof Map?r.set(h,u):r[h]=u)}else if(this.transformationType===a.CLASS_TO_CLASS){let i=d;i=this.applyCustomTransformations(i,n,p,e,this.transformationType),(i!==void 0||this.options.exposeUnsetFields)&&(r instanceof Map?r.set(h,i):r[h]=i)}}return this.options.enableCircularCheck&&this.recursionStack.delete(e),r}else return e}}applyCustomTransformations(t,e,n,f,o){let c=m.findTransformMetadatas(e,n,this.transformationType);return this.options.version!==void 0&&(c=c.filter(s=>s.options?this.checkVersion(s.options.since,s.options.until):!0)),this.options.groups&&this.options.groups.length?c=c.filter(s=>s.options?this.checkGroups(s.options.groups):!0):c=c.filter(s=>!s.options||!s.options.groups||!s.options.groups.length),c.forEach(s=>{t=s.transformFn({value:t,key:n,obj:f,type:o,options:this.options})}),t}isCircular(t){return this.recursionStack.has(t)}getReflectedType(t,e){if(!t)return;let n=m.findTypeMetadata(t,e);return n?n.reflectedType:void 0}getKeys(t,e,n){let f=m.getStrategy(t);f==="none"&&(f=this.options.strategy||"exposeAll");let o=[];if((f==="exposeAll"||n)&&(e instanceof Map?o=Array.from(e.keys()):o=Object.keys(e)),n)return o;if(this.options.ignoreDecorators&&this.options.excludeExtraneousValues&&t){let c=m.getExposedProperties(t,this.transformationType),s=m.getExcludedProperties(t,this.transformationType);o=[...c,...s]}if(!this.options.ignoreDecorators&&t){let c=m.getExposedProperties(t,this.transformationType);this.transformationType===a.PLAIN_TO_CLASS&&(c=c.map(r=>{let p=m.findExposeMetadata(t,r);return p&&p.options&&p.options.name?p.options.name:r})),this.options.excludeExtraneousValues?o=c:o=o.concat(c);let s=m.getExcludedProperties(t,this.transformationType);s.length>0&&(o=o.filter(r=>!s.includes(r))),this.options.version!==void 0&&(o=o.filter(r=>{let p=m.findExposeMetadata(t,r);return!p||!p.options?!0:this.checkVersion(p.options.since,p.options.until)})),this.options.groups&&this.options.groups.length?o=o.filter(r=>{let p=m.findExposeMetadata(t,r);return!p||!p.options?!0:this.checkGroups(p.options.groups)}):o=o.filter(r=>{let p=m.findExposeMetadata(t,r);return!p||!p.options||!p.options.groups||!p.options.groups.length})}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(o=o.filter(c=>this.options.excludePrefixes.every(s=>c.substr(0,s.length)!==s))),o=o.filter((c,s,r)=>r.indexOf(c)===s),o}checkVersion(t,e){let n=!0;return n&&t&&(n=this.options.version>=t),n&&e&&(n=this.options.version<e),n}checkGroups(t){return t?this.options.groups.some(e=>t.includes(e)):!0}};var M={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0};var L=class{instanceToPlain(t,e){return new A(a.CLASS_TO_PLAIN,x(x({},M),e)).transform(void 0,t,void 0,void 0,void 0,void 0)}classToPlainFromExist(t,e,n){return new A(a.CLASS_TO_PLAIN,x(x({},M),n)).transform(e,t,void 0,void 0,void 0,void 0)}plainToInstance(t,e,n){return new A(a.PLAIN_TO_CLASS,x(x({},M),n)).transform(void 0,e,t,void 0,void 0,void 0)}plainToClassFromExist(t,e,n){return new A(a.PLAIN_TO_CLASS,x(x({},M),n)).transform(t,e,void 0,void 0,void 0,void 0)}instanceToInstance(t,e){return new A(a.CLASS_TO_CLASS,x(x({},M),e)).transform(void 0,t,void 0,void 0,void 0,void 0)}classToClassFromExist(t,e,n){return new A(a.CLASS_TO_CLASS,x(x({},M),n)).transform(e,t,void 0,void 0,void 0,void 0)}serialize(t,e){return JSON.stringify(this.instanceToPlain(t,e))}deserialize(t,e,n){let f=JSON.parse(e);return this.plainToInstance(t,f,n)}deserializeArray(t,e,n){let f=JSON.parse(e);return this.plainToInstance(t,f,n)}};function v(l,t={}){return function(e,n){m.addTransformMetadata({target:e.constructor,propertyName:n,transformFn:l,options:t})}}var k=new L;function E(l,t,e){return k.plainToInstance(l,t,e)}function at(l){return(t,e,n)=>{let f=n.value;if(typeof f!="function")throw new Error("TransformToDto can only be applied to methods.");return n.value=function(...o){return o.length>0&&o[0]instanceof Object&&(o[0]=E(l,o[0])),f.apply(this,o)},n}}var b=class{constructor(){this.deleteYn="N"}};export{v as a,at as b,b as c};
